databaseChangeLog:
  - changeSet:
      id: SHPV2-165-4
      author: bertanasco
      comment: "Additional fields to shipment table and new tables related to milestone and milestone_events"
      changes:
        - addColumn:
            columns:
              - column:
                  name: origin
                  type: JSON
            tableName: shipment
        - addColumn:
            columns:
              - column:
                  name: destination
                  type: JSON
            tableName: shipment
        - addColumn:
            columns:
              - column:
                  name: current_milestone
                  type: JSON
            tableName: shipment
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: code
                  type: VARCHAR(32)
              - column:
                  name: description
                  type: VARCHAR(256)
              - column:
                  name: data
                  type: JSON
              - column:
                  name: shipment_id
                  constraints:
                    nullable: false
                  type: VARCHAR(48)
            tableName: milestone_events
        - dropTable:
            cascadeConstraints: true
            tableName: milestone
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: code
                  type: VARCHAR(32)
              - column:
                  name: description
                  type: VARCHAR(256)
            tableName: milestone
  - changeSet:
      id: SHPV2-165-5
      author: bertanasco
      comment: "DDL changes to support search filters in SHPV2-108"
      changes:
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: code
                  type: VARCHAR(64)
              - column:
                  name: col_group
                  type: VARCHAR(64)
              - column:
                  name: name
                  type: VARCHAR(128)
              - column:
                  name: status
                  type: VARCHAR(64)
              - column:
                  name: remark
                  type: VARCHAR(64)
              - column:
                  name: org_id
                  type: VARCHAR(64)
            tableName: service
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: city
                  type: VARCHAR(128)
              - column:
                  name: state
                  type: VARCHAR(64)
              - column:
                  name: country
                  type: VARCHAR(64)
              - column:
                  name: org_id
                  type: VARCHAR(64)
            tableName: location
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: code
                  type: VARCHAR(64)
              - column:
                  name: name
                  type: VARCHAR(64)
              - column:
                  name: org_id
                  type: VARCHAR(64)
            tableName: customer
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: country
                  type: VARCHAR(64)
              - column:
                  name: state
                  type: VARCHAR(64)
              - column:
                  name: city
                  type: VARCHAR(64)
              - column:
                  name: line1
                  type: VARCHAR(128)
              - column:
                  name: line2
                  type: VARCHAR(128)
              - column:
                  name: line3
                  type: VARCHAR(128)
              - column:
                  name: country_id
                  type: VARCHAR(48)
              - column:
                  name: state_id
                  type: VARCHAR(48)
              - column:
                  name: city_id
                  type: VARCHAR(48)
              - column:
                  name: postal_code
                  type: VARCHAR(8)
              - column:
                  name: latitude
                  type: VARCHAR(96)
              - column:
                  name: longitude
                  type: VARCHAR(208)
              - column:
                  name: manual_coordinates
                  type: boolean
              - column:
                  name: address
                  type: VARCHAR(384)
            tableName: address
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: name
                  type: VARCHAR(64)
              - column:
                  name: col_group
                  type: VARCHAR(64)
              - column:
                  name: code
                  type: VARCHAR(32)
              - column:
                  name: type
                  type: VARCHAR(32)
              - column:
                  name: status
                  type: VARCHAR(32)
              - column:
                  name: location
                  type: VARCHAR(48)
              - column:
                  name: tag
                  type: VARCHAR(32)
              - column:
                  name: note
                  type: VARCHAR(256)
              - column:
                  name: facility
                  type: VARCHAR(256)
            tableName: facility
        - addForeignKeyConstraint:
            baseColumnNames: location
            baseTableName: facility
            constraintName: fk_facility_address
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: address
        - dropColumn:
            columnName: origin
            tableName: shipment
        - dropColumn:
            columnName: destination
            tableName: shipment
        - dropColumn:
            columnName: service
            tableName: shipment
        - dropColumn:
            columnName: start_facility_id
            tableName: package_journey_segment
        - dropColumn:
            columnName: end_facility_id
            tableName: package_journey_segment
        - addColumn:
            columns:
              - column:
                  name: end_facility_id
                  type: VARCHAR(48)
                  constraints:
                    nullable: false
              - column:
                  name: start_facility_id
                  type: VARCHAR(48)
                  constraints:
                    nullable: false
            tableName: package_journey_segment
        - addColumn:
            columns:
              - column:
                  name: customer_id
                  type: VARCHAR(48)
              - column:
                  name: service_id
                  type: VARCHAR(48)
                  constraints:
                    nullable: false
              - column:
                  name: status
                  type: VARCHAR(32)
                  constraints:
                    nullable: false
              - column:
                  name: origin
                  type: VARCHAR(48)
                  constraints:
                    nullable: false
              - column:
                  name: destination
                  type: VARCHAR(48)
                  constraints:
                    nullable: false
            tableName: shipment
        - addForeignKeyConstraint:
            baseColumnNames: customer_id
            baseTableName: shipment
            constraintName: fk_shipment_customer
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: customer
        - addForeignKeyConstraint:
            baseColumnNames: service_id
            baseTableName: shipment
            constraintName: fk_shipment_service
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: service
        - addForeignKeyConstraint:
            baseColumnNames: origin
            baseTableName: shipment
            constraintName: fk_shipment_origin_address
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: address
        - addForeignKeyConstraint:
            baseColumnNames: destination
            baseTableName: shipment
            constraintName: fk_shipment_destination_address
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: address
        - addForeignKeyConstraint:
            baseColumnNames: start_facility_id
            baseTableName: package_journey_segment
            constraintName: fk_package_journey_segment_start_facility_address
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: facility
        - addForeignKeyConstraint:
            baseColumnNames: end_facility_id
            baseTableName: package_journey_segment
            constraintName: fk_package_journey_segment_end_facility_address
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: facility
  - changeSet:
      id: SHPV2-171-6
      author: bertanasco
      comment: "Introduce Location Hierarchy, Location and updates on Address"
      changes:
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: org_id
                  type: VARCHAR(48)
              - column:
                  name: country
                  type: VARCHAR(64)
              - column:
                  name: state
                  type: VARCHAR(64)
              - column:
                  name: city
                  type: VARCHAR(64)
              - column:
                  name: active
                  type: boolean
            tableName: location_hierarchy
        - dropForeignKeyConstraint:
            baseTableName: facility
            constraintName: fk_facility_address
        - dropTable:
            cascadeConstraints: true
            tableName: location
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: VARCHAR(48)
              - column:
                  name: org_id
                  type: VARCHAR(48)
              - column:
                  name: type
                  type: VARCHAR(32)
              - column:
                  name: code
                  type: VARCHAR(64)
              - column:
                  name: description
                  type: VARCHAR(64)
            tableName: location
        - addForeignKeyConstraint:
            baseColumnNames: org_id
            baseTableName: location_hierarchy
            constraintName: fk_location_hierarchy_organizatin
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: organization
        - addForeignKeyConstraint:
            baseColumnNames: country
            baseTableName: location_hierarchy
            constraintName: fk_location_hierarchy_country_location
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: location
        - addForeignKeyConstraint:
            baseColumnNames: state
            baseTableName: location_hierarchy
            constraintName: fk_location_hierarchy_state_location
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: location
        - addForeignKeyConstraint:
            baseColumnNames: city
            baseTableName: location_hierarchy
            constraintName: fk_location_hierarchy_city_location
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: location
        - dropColumn:
            columns:
              - column:
                  name: country
              - column:
                  name: state
              - column:
                  name: city
              - column:
                  name: country_id
              - column:
                  name: state_id
              - column:
                  name: city_id
              - column:
                  name: postal_code
              - column:
                  name: latitude
              - column:
                  name: longitude
              - column:
                  name: manual_coordinates
              - column:
                  name: address
            tableName: address
        - addColumn:
            columns:
              - column:
                  name: location_hierarchy_id
                  type: VARCHAR(48)
            tableName: address
        - addForeignKeyConstraint:
            baseColumnNames: location_hierarchy_id
            baseTableName: address
            constraintName: fk_address_location_hierarchy
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: location_hierarchy
        - addColumn:
            columns:
              - column:
                  name: description
                  type: VARCHAR(256)
            tableName: service
        - addForeignKeyConstraint:
            baseColumnNames: org_id
            baseTableName: service
            constraintName: fk_service_organization
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: organization
        - dropColumn:
            columns:
              - column:
                  name: status
              - column:
                  name: remark
              - column:
                  name: col_group
            tableName: service
        - dropColumn:
            columns:
              - column:
                  name: col_group
              - column:
                  name: code
              - column:
                  name: type
              - column:
                  name: status
              - column:
                  name: tag
              - column:
                  name: note
              - column:
                  name: facility
              - column:
                  name: location
            tableName: facility
        - addColumn:
            columns:
              - column:
                  name: org_id
                  type: VARCHAR(48)
              - column:
                  name: address
                  type: VARCHAR(48)
            tableName: facility
        - addForeignKeyConstraint:
            baseColumnNames: org_id
            baseTableName: facility
            constraintName: fk_facility_organization
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: organization
        - addForeignKeyConstraint:
            baseColumnNames: address
            baseTableName: facility
            constraintName: fk_facility_address
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: address
  - changeSet:
      id: SHPV2-171-7
      author: bertanasco
      comment: "Rename service to service_type"
      changes:
        - renameTable:
            newTableName: service_type
            oldTableName: service
  - changeSet:
      id: SHPV2-195
      author: franciscoramos
      comment: "re create index"
      changes:
        - dropTable:
            tableName: shipment_journey_package_journey_segment
        - createTable:
            columns:
              - column:
                  constraints:
                    nullable: false
                  name: shipmentjourney_id
                  type: VARCHAR(32)
              - column:
                  constraints:
                    nullable: false
                  name: packagejourneysegments_id
                  type: VARCHAR(32)
              - column:
                  constraints:
                    nullable: false
                  defaultValue: 1
                  name: version
                  type: INTEGER
            tableName: shipment_journey_package_journey_segment
        - addForeignKeyConstraint:
            baseColumnNames: shipmentjourney_id
            baseTableName: shipment_journey_package_journey_segment
            constraintName: fk_shipment_journey_package_journey_segment1
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: shipment_journey
        - addForeignKeyConstraint:
            baseColumnNames: packagejourneysegments_id
            baseTableName: shipment_journey_package_journey_segment
            constraintName: fk_shipment_journey_package_journey_segment2
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: id
            referencedTableName: package_journey_segment
        - createIndex:
            columns:
              - column:
                  name: packagejourneysegments_id
            indexName: shipment_journey_package_journey_segment2_idx
            tableName: shipment_journey_package_journey_segment
            unique: false
        - createIndex:
            columns:
              - column:
                  name: shipmentjourney_id
            indexName: shipment_journey_package_journey_segment1_idx
            tableName: shipment_journey_package_journey_segment
            unique: false
  - changeSet:
      id: SHPV2-287-8
      author: bertanasco
      comment: "Add unique constraints"
      changes:
        - addUniqueConstraint:
            columnNames: code, org_id
            constraintName: service_type_unique_constraint
            tableName: service_type
        - addUniqueConstraint:
            columnNames: code, org_id
            constraintName: customer_unique_constraint
            tableName: customer
        - addUniqueConstraint:
            columnNames: org_id, country, state, city
            constraintName: location_hierarchy_unique_constraint
            tableName: location_hierarchy
        - addUniqueConstraint:
            columnNames: org_id, type, code
            constraintName: location_unique_constraint
            tableName: location